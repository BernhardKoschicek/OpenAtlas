from flask import request
from flask_restful import Resource, marshal

import openatlas.api.v02.templates.geojson as template
from openatlas.api.v02.resources.geojson_entity import GeoJsonEntity
from openatlas.api.v01.parameter import Validation
from openatlas.api.v02.resources.parser import entity_parser


class GetEntity(Resource):
    def get(self, id_):
        args = entity_parser.parse_args()
        validation = Validation.validate_url_query(request.args)
        entity = GeoJsonEntity.get_entity(id_, validation)
        print(entity)
        #entity = {"@context":"https://raw.githubusercontent.com/LinkedPasts/linked-places/master/linkedplaces-context-v1.jsonld","features":[{"@id":"http://127.0.0.1:5000/entity/6338","crmClass":"crm:E18_Physical_Thing","depictions":[{"@id":"http://127.0.0.1:5000/api/0.1/entity/6332","license":"Proprietary license","title":"Unbenannt","url":"http://127.0.0.1:5000/api/display/6332.png"}],"geometry":{"geometries":[{"coordinates":[15.45,47.06667],"description":"Graz (2778067), imported from GeoNames","title":"Graz","type":"Point"},{"coordinates":[[[15.5674182946908,47.0041386896525],[15.5097305530886,47.0074163729377],[15.5190017972746,47.0385443338331],[15.5509360828045,47.0432236603769],[15.5674182946908,47.0041386896525]]],"description":"ete","title":"poly1","type":"Polygon"},{"coordinates":[[[15.3957285875413,46.989152433469],[15.348342228368,47.0020315013396],[15.3476554695394,47.0170141456481],[15.388517619841,47.0191207429378],[15.3957285875413,46.989152433469]]],"description":"wrgrtw","title":"Poly 2","type":"Polygon"},{"coordinates":[[15.3696264259776,47.148867004192],[15.3208665491472,47.090461854335],[15.3404391757622,47.0558557921126],[15.3504025048538,47.0635739553919]],"description":"desc line","title":"line","type":"LineString"}],"type":"GeometryCollection"},"links":[{"identifier":"https://www.geonames.org/2778067","type":"closeMatch"}],"properties":{"title":"Annaa"},"relations":[{"label":"Location of Annaa","relationTo":"http://127.0.0.1:5000/api/0.1/entity/6339","relationType":"crm:P53_has_former_or_current_location"},{"label":"2778067","relationTo":"http://127.0.0.1:5000/api/0.1/entity/6340","relationType":"crm:P67i_refers_to"},{"label":"Unbenannt","relationTo":"http://127.0.0.1:5000/api/0.1/entity/6332","relationType":"crm:P67i_refers_to"}],"type":"Feature"}],"type":"FeatureCollection"}
        #entity = {"@context":"https://raw.githubusercontent.com/LinkedPasts/linked-places/master/linkedplaces-context-v1.jsonld","features":[{"@id":"http://127.0.0.1:5000/entity/104","crmClass":"crm:E21_Person","depictions":[{"@id":"http://127.0.0.1:5000/api/0.1/entity/1015","license":"Open license","title":"House of Prince Miloš Obrenović in Untere Donaustraße 23 (1020 Vienna)","url":"http://127.0.0.1:5000/api/display/1015.jpg"},{"@id":"http://127.0.0.1:5000/api/0.1/entity/211","license":"Public Domain","title":"Prince Miloš Obrenović (1780-1860)","url":"http://127.0.0.1:5000/api/display/211.jpg"}],"description":[{"value":"Prince Miloš Obrenović (1780-1860) was the leader of the Second Serbian Uprising (1815-1817) against the Ottoman Empire, ruler of Serbia (1815-1839 and 1858-1860) and founder of the Obrenović Dynasty. Under his rule Serbia became an autonomous principality within the Ottoman Empire. During his reign the modernisation of Serbia had begun through numerous reforms (first schools, courts, administration, publishing houses, the first Constitution in 1835, church reforms etc.).\nMiloš Obrenović lived in Vienna with interruption from 1841 to 1858. In this period he had contact not only with many renowned Viennese Serbs (e.g. Vuk Stefanović Karadžić, Branko Radičević, Anastas Jovanović, Djura Daničić...), but also with other important Slavs and Orthodox personalities in Vienna as well – especially with the Greek families Sina, Dumba and Tirka and with the Russian Orthodox priest Mihail Fjodorovič Rajevski (1811-1884)."}],"names":[{"alias":"Fürst Milosch Obrenovich"},{"alias":"Fürst Milosch Obrenowitch"},{"alias":"Fürst Milosch Theodorowitsch Obrenowitsch"},{"alias":"Кнез Милош Обреновић"}],"properties":{"title":"Obrenović Miloš Prince (1780-1860)"},"relations":[{"label":"A Digital Geoportal of the History of the Serbs in Vienna 1741-1918","relationTo":"http://127.0.0.1:5000/api/0.1/entity/4968","relationType":"crm:P2_has_type"},{"label":"Fürst Milosch Obrenovich","relationTo":"http://127.0.0.1:5000/api/0.1/entity/5797","relationType":"crm:P131_is_identified_by"},{"label":"Fürst Milosch Obrenowitch","relationTo":"http://127.0.0.1:5000/api/0.1/entity/5796","relationType":"crm:P131_is_identified_by"},{"label":"Fürst Milosch Theodorowitsch Obrenowitsch","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1189","relationType":"crm:P131_is_identified_by"},{"label":"Location of Obrenović-Palais","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1685","relationType":"crm:P74_has_current_or_former_residence"},{"label":"Male","relationTo":"http://127.0.0.1:5000/api/0.1/entity/26","relationType":"crm:P2_has_type"},{"label":"Nikolić de Rudna Jelisaveta-Savka  (1814-1848)","relationTo":"http://127.0.0.1:5000/api/0.1/entity/399","relationType":"crm:OA7_has_relationship_to"},{"label":"Obrenović Mihailo Prince (1823-1868)","relationTo":"http://127.0.0.1:5000/api/0.1/entity/179","relationType":"crm:OA7_has_relationship_to"},{"label":"Ruler","relationTo":"http://127.0.0.1:5000/api/0.1/entity/3653","relationType":"crm:P2_has_type"},{"label":"Кнез Милош Обреновић","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1190","relationType":"crm:P131_is_identified_by"},{"label":"\"zum Fürsten Milosch\"","relationTo":"http://127.0.0.1:5000/api/0.1/entity/2579","relationType":"crm:P11i_had_participant"},{"label":"House of Prince Miloš Obrenović in Untere Donaustraße 23 (1020 Vienna)","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1015","relationType":"crm:P67i_refers_to"},{"label":"Obrenović-Palais","relationTo":"http://127.0.0.1:5000/api/0.1/entity/2528","relationType":"crm:P11i_had_participant"},{"label":"Obrenović Jekatarina- Katica  (1826-1848)","relationTo":"http://127.0.0.1:5000/api/0.1/entity/403","relationType":"crm:OA7i_has_relationship_to"},{"label":"Prince Miloš Obrenović (1780-1860)","relationTo":"http://127.0.0.1:5000/api/0.1/entity/211","relationType":"crm:P67i_refers_to"},{"label":"Prince Miloš Obrenović bought the house in Annagasse 12 in November 1845.","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1197","relationType":"crm:P14i_carried_out_by"},{"label":"Prince Miloš Obrenović bought the house in Lainzer Straße 39 at the beginning of the year 1846.","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1194","relationType":"crm:P14i_carried_out_by"},{"label":"Prince Miloš Obrenović bought the house in Landstraßer Hauptstraße 90 at the latest in 1843 and sold it at the latest in 1846.","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1208","relationType":"crm:P14i_carried_out_by"},{"label":"Prince Miloš Obrenović bought the house in Untere Donaustrasse 23 at the latest in 1852.","relationTo":"http://127.0.0.1:5000/api/0.1/entity/1214","relationType":"crm:P14i_carried_out_by"},{"label":"Prince Miloš´s gift to the Austrian Emperor Ferdinand I in 1841","relationTo":"http://127.0.0.1:5000/api/0.1/entity/2508","relationType":"crm:P11i_had_participant"},{"label":"Venue of the first Slavic Ball","relationTo":"http://127.0.0.1:5000/api/0.1/entity/2549","relationType":"crm:P11i_had_participant"},{"label":"Venue of the third Slavic Ball","relationTo":"http://127.0.0.1:5000/api/0.1/entity/2503","relationType":"crm:P11i_had_participant"}],"type":"Feature","types":[{"description":"This research project focuses on one of the aspects of the history and presence of Orthodox Christians, and in particular of the Orthodox Serbs, in Vienna. Quite often the opinion emerges in the contemporary public discourse that the Orthodox Christians have come to Austria for the first time in the wake of the so-called \"Gastarbeiterbewegung\" of the 1960s and 1970s. However, their history and presence in Austria dates well back to the 17th century. In fact, according to the Austro-Hungarian population census of 1910, more than 2,000,000 Serbs lived in the Habsburg monarchy: in Hungary a total of 1,106,471, in Bosnia and Herzegovina 825,338 and in Dalmatia 105,000.\nThis research project uses biographical data on the Orthodox Serbs in Vienna in the period from 1741 until 1918 in order to illustrate how the Orthodox began to migrate to the Habsburg Empire, how Orthodox merchants settled in Vienna and how they integrated into Viennese society of that time. On the basis of meticulously researched data in Austrian archives the life of famous Serbs in Vienna is reconstructed. Their places of dwelling and action are localised and embedded into a customised OpenAtlas database with an online Geoportal, which will be open to the interested public at the end of the project.\nThis project aims to gain a better understanding of contemporary developments and future trends in Orthodox Christianity based on scholarly research on famous Serbian personalities of the 18th and 19th centuries in detail, which were already integrated into Austrian society at that time in Vienna as well as in Austria in general.\n","hierarchy":"Case Study","identifier":"http://127.0.0.1:5000/api/0.1/entity/4968","label":"A Digital Geoportal of the History of the Serbs in Vienna 1741-1918"},{"hierarchy":"Profession","identifier":"http://127.0.0.1:5000/api/0.1/entity/3653","label":"Ruler"},{"hierarchy":"Sex","identifier":"http://127.0.0.1:5000/api/0.1/entity/26","label":"Male"}],"when":{"timespans":[{"end":{"earliest":"1860-09-26"},"start":{"earliest":"1780-03-18"}}]}}],"type":"FeatureCollection"}
        return marshal(entity, template.entity_json), 200
