{% extends "layout.html" %}
{% block title_name %} - {{ _('admin')|uc_first }}{% endblock %}
{% block breadcrumb %}
    {{ [_('admin')]|crumb }}
{% endblock %}
{% block content %}
<div class="row">
    <div class="col-6">
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item"><a class="nav-link active" data-toggle="tab" role="tab" aria-selected="true" href="#tab-general">{{ _('general')|uc_first }}</a></li>
            <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" aria-selected="false" href="#tab-user">{{ _('user')|uc_first }}</a></li>
            <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" aria-selected="false" href="#tab-files">{{ _('files')|uc_first }}</a></li>
            {% if 'manager'|is_authorized %}
                <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" aria-selected="false" href="#tab-map">{{ _('map')|uc_first }}</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" aria-selected="false" href="#tab-content">{{ _('content')|uc_first }}</a></li>
            {% endif %}
            {% if 'admin'|is_authorized %}
                <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" aria-selected="false" href="#tab-mail">{{ _('email')|uc_first }}</a></li>
            {% endif  %}

        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" role="tabpanel" id="tab-general">
                <div class="toolbar">
                    {{ 'General'|manual_link }}
                    {% if 'admin'|is_authorized %}
                        {{ _('edit settings')|button(url_for('admin_general')) }}
                    {% endif  %}
                </div>
                <div>
                    {{ info.general|display_info }}
                </div>
                {% if disk_space_info %}
                    <div id="disk-size"></div>
                    <p>
                        {{ _('total disk space')|uc_first }} <strong>{{ disk_space_info.total }}</strong> -
                        {{ _('free disk space')|uc_first }} <strong>{{ disk_space_info.free }}</strong>
                    </p>
                    <script>
                        $( function() {
                            $("#disk-size").progressbar({value: {{ disk_space_info.percent }} });
                        });
                    </script>
                {% endif %}
            </div>
            <div class="tab-pane fade" role="tabpanel" id="tab-user">
                <div class="toolbar">
                    {{ 'User'|manual_link }}
                    {% if 'manager'|is_authorized and session['settings']['mail'] %}
                        {{ _('user')|button(url_for('user_insert')) }}
                    {% endif %}
                    {{ _('activity')|button(url_for('user_activity')) }}
                    {% if 'manager'|is_authorized and session['settings']['mail'] %}
                        {{ _('newsletter')|button(url_for('admin_newsletter')) }}
                    {% endif %}
                </div>
                <div>
                    {{ tables.user.display('user')|safe }}
                </div>
            </div>
            <div class="tab-pane fade" role="tabpanel" id="tab-files">
                <div class="toolbar">
                    {{ 'Files'|manual_link }}
                    {{ _('file')|button(url_for('file_insert')) }}
                    {{ _('list')|button(url_for('file_index')) }}
                    {% if 'manager'|is_authorized %}
                        {{  _('edit settings')|button(url_for('admin_file')) }}
                    {% endif %}
                </div>
                {% for dir, value in writeable_dirs.items() %}
                    {% if not value %}
                        <p>
                            <span class="error">{{ _('directory not writable')|uc_first }}: {{ dir }}</span>
                        </p>
                    {% endif %}
                {% endfor %}
                <div>
                    {{ info.file|display_info }}
                </div>
            </div>
            {% if 'manager'|is_authorized %}
                <div class="tab-pane fade" role="tabpanel" id="tab-map">
                    <div class="toolbar">
                        {{ 'Map'|manual_link }}
                        {{ _('edit settings')|button(url_for('admin_map')) }}
                    </div>
                    <div>
                        {{ info.map|display_info }}
                    </div>
                </div>
                <div class="tab-pane fade" role="tabpanel" id="tab-content">
                    <div class="toolbar">
                        {{ 'Content'|manual_link }}
                    </div>
                    <div>
                        {{ tables.content.display('content')|safe }}
                    </div>
                </div>
            {% endif %}
            {% if 'admin'|is_authorized %}
                <div class="tab-pane fade" role="tabpanel" id="tab-mail">
                    <div class="toolbar">
                        {{ 'Mail'|manual_link }}
                        {{ _('edit settings')|button(url_for('admin_mail')) }}
                    </div>
                    <div>
                        {{ info.mail|display_info }}
                    </div>
                    {% if settings['mail'] %}
                        {{ form|display_form }}
                    {% endif %}
                </div>
            {% endif  %}
        </div>
    </div>
</div>


    <div id="admin_index" style="margin-top:2em;">

        {% if 'manager'|is_authorized %}
            <a href="{{ url_for('admin_logo') }}">{{ _('logo')|uc_first }}</a>
        {% endif %}
        <h1>{{ _('logs')|uc_first }}</h1>
        {% if 'admin'|is_authorized %}
            <a href="{{ url_for('admin_log') }}">{{ _('system log')|uc_first }}</a>
        {% endif %}

        {% if 'contributor'|is_authorized %}
            <h1>{{ _('data transfer')|uc_first }}</h1>
            {% if 'manager'|is_authorized %}
                <a href="{{ url_for('admin_api') }}">API</a>
                <a href="{{ url_for('export_csv') }}">{{ _('export')|uc_first }} CSV</a>
                <a href="{{ url_for('export_sql') }}">{{ _('export')|uc_first }} SQL</a>
            {% endif %}
            <a href="{{ url_for('import_index') }}">{{ _('import')|uc_first }}</a>
            {% if 'admin'|is_authorized %}
                <a href="{{ url_for('sql_index') }}">SQL</a>
            {% endif %}
        {% endif  %}
        {% if 'contributor'|is_authorized %}
            <h1>{{ _('data integrity')|uc_first }}</h1>
            <a href="{{ url_for('admin_orphans') }}">{{ _('orphans')|uc_first }}</a>
            <a href="{{ url_for('admin_check_links') }}">{{ _('check links')|uc_first }}</a>
            <a href="{{ url_for('admin_check_dates') }}">{{ _('check dates')|uc_first }}</a>
            <a href="{{ url_for('admin_check_link_duplicates')}}">{{ _('check link duplicates')|uc_first }}</a>
            <a href="{{ url_for('admin_check_similar')}}">{{ _('check similar names')|uc_first }}</a>
        {% endif %}
    </div>
{% endblock %}
